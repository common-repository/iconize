!function(e){"use strict";tinymce.create("tinymce.plugins.IconizePlugin",{init:function(t,n){var o=this;t.on("BeforeExecCommand",(function(n){var o,i,a=n.command,s=t.selection.getNode(),c=t.dom.getParent(s,"A"),d=t.dom.getParent(s,"span.iconized-stack");"WP_Link"===a?t.dom.hasClass(s,"iconized")&&(o=d||s,(c=t.dom.getParent(s,"A"))||e(o).wrap('<a href="http://">'),t.selection.select(o),t.selection.collapse(0)):"unlink"===a&&(t.dom.getParent(s,".iconized")||d)&&c&&(i=t.selection.getBookmark(),t.dom.remove(c,1),t.selection.moveToBookmark(i))})),e("#wp-link").on("visibility",(function(){var n=e(this);setInterval((function(){if(n.is(":hidden")){var e,o=t.selection.getNode(),i=t.dom.getParent(o,"A");null===i||t.dom.getAttrib(i,"href")&&"http://"!==t.dom.getAttrib(i,"href")||(e=t.selection.getBookmark(),t.dom.remove(i,1),t.selection.moveToBookmark(e),t.focus())}}),300)})).trigger("visibility"),t.on("init",(function(){t.on("mousedown",(function(n){var i=t.getBody();if(t.dom.hasClass(n.target,"iconized")||t.dom.hasClass(n.target,"iconized-placeholder"))return tinymce.Env.ie&&e(i).attr({contenteditable:!1}),n.preventDefault(),n.stopPropagation(),o._selectIcon(t,n.target),t.focus(),!1;tinymce.Env.ie&&e(i).attr({contenteditable:!0})})),t.on("mouseup",(function(n){if(tinymce.Env.ie){var o=t.getBody();(t.dom.hasClass(n.target,"iconized")||t.dom.hasClass(n.target,"iconized-placeholder"))&&t.dom.getParent(n.target,"A")&&e(o).attr({contenteditable:!0})}})),t.on("keydown",(function(n){var o,i,a,s,c=t.getBody();if(o=n.keyCode?n.keyCode:n.which,(!n.metaKey||!n.ctrlKey||!(o>=112&&o<=123)||8!==o||46!==o)&&(i=t.selection.getNode(),t.dom.hasClass(i,"iconized")))return tinymce.Env.ie&&e(c).attr({contenteditable:!0}),n.preventDefault(),a=t.dom.getParent(i,"span.iconized-stack")||i,s=t.dom.create("span",{class:"iconize-cph","data-mce-bogus":"true"},"\ufeff"),37===o||38===o?a.parentNode.insertBefore(s,a):t.dom.insertAfter(s,a),t.selection.setCursorLocation(s,0),t.selection.collapse(1),t.dom.remove(s),!1}))})),t.addCommand("insertIcon",(function(){void 0!==window.iconizeTinymceDialog&&window.iconizeTinymceDialog.open(t.id)})),t.addCommand("swapIconsPositions",(function(){var e=t.selection.getNode(),n=t.dom.getPrev(e,".iconized"),o=t.dom.getNext(e,".iconized");n?(t.dom.insertAfter(n,e),t.selection.select(n)):o&&(e.parentNode.insertBefore(o,e),t.selection.select(o))})),t.addCommand("swapIconsSizes",(function(){var e=t.selection.getNode(),n=t.dom.getPrev(e,".iconized"),o=t.dom.getNext(e,".iconized"),i=n||o,a="iconized-stack-base";i&&(t.dom.hasClass(i,a)?(t.dom.removeClass(i,a),t.dom.addClass(e,a)):t.dom.hasClass(e,a)&&(t.dom.removeClass(e,a),t.dom.addClass(i,a)))})),t.addCommand("removeIcon",(function(){var n,o,i,a,s,c,d=t.selection.getNode(),r=t.dom.hasClass(d,"iconized"),m=t.dom.getParent(d,"span.iconized-stack"),l="",g=iconizeTinymceDialog.getSelectOptions(e("#mce-icon-size")),p=iconizeTinymceDialog.getSelectOptions(e("#mce-icon-align"));if(r){if(m){n=t.dom.getAttrib(m,"class").split(/ /);for(var v=0;v<n.length;v++)-1!==e.inArray(n[v],g)&&(s=n[v]),-1!==e.inArray(n[v],p)&&(c=n[v]);o=t.dom.getPrev(d,".iconized"),i=t.dom.getNext(d,".iconized"),(a=o||i)&&(t.dom.hasClass(a,"iconized-stack-base")&&t.dom.removeClass(a,"iconized-stack-base"),s&&t.dom.addClass(a,s),c&&t.dom.addClass(a,c),l=a.outerHTML),t.dom.remove(m),t.execCommand("mceInsertContent",!1,l)}else t.dom.remove(d);t.nodeChanged()}})),t.addButton("insert_icon",{title:o._translate(t,"insert_icon_title"),cmd:"insertIcon",image:n+"/images/flag.png",onPostRender:function(){var e=this;t.on("NodeChange",(function(n){var o=n.element;e.active(t.dom.getParent(o,".iconized")&&!t.selection.isCollapsed())}))}}),t.addButton("swap_icon_positions",{title:o._translate(t,"swap_pos_title"),cmd:"swapIconsPositions",image:n+"/images/swappos.png",onPostRender:function(){var e=this;t.on("NodeChange",(function(n){var o=n.element;e.disabled(!(t.dom.getParent(o,".iconized")&&t.dom.getParent(o,".iconized-stack")&&(t.dom.getPrev(o,".iconized")||t.dom.getPrev(o.parentNode,".iconized")||t.dom.getNext(o,".iconized")||t.dom.getNext(o.parentNode,".iconized"))))}))}}),t.addButton("swap_icon_sizes",{title:o._translate(t,"swap_size_title"),cmd:"swapIconsSizes",image:n+"/images/swapsizes.png",onPostRender:function(){var e=this;t.on("NodeChange",(function(n){var o=n.element;e.disabled(!(t.dom.getParent(o,".iconized")&&t.dom.getParent(o,".iconized-stack")&&(t.dom.getPrev(o,".iconized")||t.dom.getPrev(o.parentNode,".iconized")||t.dom.getNext(o,".iconized")||t.dom.getNext(o.parentNode,".iconized"))))}))}}),t.addButton("remove_icon",{title:o._translate(t,"remove_icon_title"),cmd:"removeIcon",image:n+"/images/unflag.png",onPostRender:function(){var e=this;t.on("NodeChange",(function(n){var o=n.element;e.disabled(!(t.dom.getParent(o,".iconized")&&!t.selection.isCollapsed()))}))}}),o._handlePlaceholder(t),t.on("NodeChange",(function(e){var n=e.element;"SPAN"===n.nodeName&&t.dom.hasClass(n,"iconized-placeholder")&&o._selectIcon(t,n)}))},getInfo:function(){return{longname:"Iconize WordPress Plugin",author:"THATplugin",authorurl:"https://thatplugin.com/",infourl:"https://thatplugin.com/",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_selectIcon:function(t,n){t.dom.hasClass(n,"iconized-placeholder")?tinymce.Env.webkit?(e(n.parentNode).removeAttr("contenteditable"),t.selection.select(n.parentNode),e(n.parentNode).attr({contenteditable:!1})):t.selection.select(n.parentNode):t.selection.select(n)},_handlePlaceholder:function(t){t.on("ResolveName",(function(e){t.dom;var n=e.target;t.dom.hasClass(n,"iconized")?e.name=t.selection.isCollapsed()?"placeholder":"iconized":t.dom.hasClass(n,"iconized-stack")&&(e.name=t.selection.isCollapsed()?"placeholder":"iconized-stack")})),t.on("BeforeSetContent",(function(t){if(t.content){var n=e("<div></div>");n.html(t.content),e(n).find(".iconized").each((function(){var t=e(this);t.parent(".iconized-stack")?(t.parent(".iconized-stack").attr({contenteditable:"false","data-mce-resize":"false"}),t.empty().attr("data-mce-resize","false").removeClass("mceItemNoResize").append('<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>')):t.empty().attr("contenteditable","false").removeClass("mceItemNoResize").append('<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>')}));var o=e(n).html();t.content=o,e(n).remove()}})),t.on("PostProcess",(function(t){if(t.get){var n=e("<div></div>");n.html(t.content),e(n).find(".iconized").each((function(){var t=e(this);t.parent(".iconized-stack")&&t.parent(".iconized-stack").removeAttr("contenteditable").removeAttr("data-mce-resize").removeClass("mceItemNoResize"),t.empty().removeAttr("contenteditable").removeAttr("data-mce-resize").removeClass("mceItemNoResize")}));var o=e(n).html();t.content=o,e(n).remove()}}))},_translate:function(e,t){return this._isGutenbergActive()?tinymce.translate(t):e.getLang("iconize_mce."+t)},_isGutenbergActive:function(){return document.body.classList.contains("block-editor-page")}}),tinymce.PluginManager.add("iconize_mce",tinymce.plugins.IconizePlugin)}(jQuery);