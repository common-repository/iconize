var iconizeTinymceDialog;!function(e){"use strict";var i,o,n,a,c,t,l,s,r,m={},d=[],g="",z=[],f="",v=[],u=[],p=[],h=[],y=[],D=[],T=[],C=[],k=[],w=[],b=["iconized","iconized-stack-base"],A=["iconized-stack"],S="hover-color-change";iconizeTinymceDialog={textarea:"",init:function(){if(m.dialog=e("#iconize-mce-modal"),m.submit=e("#iconize-mce-update"),m.stack=e("#iconize-mce-stack"),m.set=e("#mce-icon-set"),m.name=e("#mce-icon-name"),m.effect=e("#mce-icon-effect"),m.transform=e("#mce-icon-transform"),m.animate=e("#mce-icon-animate"),m.hover=e("#mce-icon-hover"),m.color=e("#mce-icon-color"),m.hovercolor=e("#mce-icon-color-hover"),m.size=e("#mce-icon-size"),m.customsize=e("#mce-icon-custom-size"),m.align=e("#mce-icon-align"),m.custom=e("#mce-icon-custom-classes"),c=e("#iconize-mce-icons"),t=e("#iconize-mce-title"),l=e("#mce-icon-size-howto"),s=e("#mce-icon-align-howto"),r=e("#mce-color-hover-checkbox"),h=iconizeTinymceDialog.getSelectOptions(m.set),C=iconizeTinymceDialog.getSelectOptions(m.transform),k=iconizeTinymceDialog.getSelectOptions(m.animate),w=iconizeTinymceDialog.getSelectOptions(m.hover),D=iconizeTinymceDialog.getSelectOptions(m.size),T=iconizeTinymceDialog.getSelectOptions(m.align),p=iconizeTinymceDialog.getSelectOptions(m.effect),iconizeDialogParams.icons)for(var i=0;i<h.length;i++){var o=h[i],n=iconizeDialogParams.icons[o],a=e('<ul id="'+o+'-icons-list">').addClass("icons-list");c.append(a),e.merge(u,n);for(var g=0;g<n.length;g++){var z,f=n[g],v="glyph-"+f;z='<li class="icons-list-item">',z+='<a href="#" class="icons-list-icon" title="'+f+'" data-set="'+o+'">',z+='<span class="iconized '+o+" "+v+'"></span>',z+="</a>",z+="</li>",a.append(z),d.push({label:f,set:o}),y.push(v)}}A.push(S),e.merge(A,b),e.merge(A,y),e.merge(A,h),e.merge(A,C),e.merge(A,k),e.merge(A,w),e.merge(A,D),e.merge(A,T),m.set.change((function(){var i="#"+e(this).val()+"-icons-list";c.find(".icons-list").hide(),c.find(i).show(),c.scrollTop(0)})),m.name.iconizeautocomplete({appendTo:m.dialog,source:d,minLength:1,change:function(i,o){if(null===o.item){var n=c.find(".selected-icon"),a=n.attr("title"),t=n.data("set");n.length?(e(this).val(a),m.set.val(t)):(e(this).val(""),m.set.val(h[0]))}},select:function(e,i){iconizeTinymceDialog.unselectIcon(),iconizeTinymceDialog.selectIcon(i.item.set,i.item.value),iconizeTinymceDialog.scrollToIcon()}}).bind("focus",(function(){e(this).iconizeautocomplete("search")})),m.color.wpColorPicker({change:function(){iconizeTinymceDialog.setColor(e(this).wpColorPicker("color")),r.removeClass("hidden")},clear:function(){iconizeTinymceDialog.setColor(""),r.addClass("hidden")}}),m.custom.tagit({autocomplete:{disabled:!0},preprocessTag:function(e){if(!e)return"";var i=e.replace(/^[^-_a-zA-Z]+/,"").replace(/^-(?:[-0-9]+)/,"-");return i&&i.replace(/[^-_a-zA-Z0-9]+/g,"-")},afterTagAdded:function(i,o){-1!==e.inArray(o.tagLabel,A)&&(alert(iconizeDialogParams.l10n.reserved_class),m.custom.tagit("removeTag",o.tag))}}),m.submit.click((function(e){e.preventDefault(),iconizeTinymceDialog.update()})),m.stack.click((function(e){e.preventDefault(),iconizeTinymceDialog.stack()})),e("#iconize-mce-modal .icons-list-icon").click((function(i){i.preventDefault();var o=e(this);!1===o.hasClass("selected-icon")&&(c.find(".icons-list-icon.selected-icon").removeClass("selected-icon"),o.addClass("selected-icon"),m.name.val(o.attr("title")))})),m.dialog.on("show.wpbs.modal",iconizeTinymceDialog.refresh),m.dialog.on("shown.wpbs.modal",(function(){iconizeTinymceDialog.scrollToIcon(!0)})),m.dialog.on("hide.wpbs.modal",iconizeTinymceDialog.onClose),m.dialog.on("hidden.wpbs.modal",iconizeTinymceDialog.setDefaultValues),iconizeSettings.iconizeQuicktags&&"undefined"!=typeof QTags&&QTags.addButton("icon","icon",(function(){iconizeTinymceDialog.open()}),"","",iconizeDialogParams.l10n.insert,130)},isMCE:function(){return i&&!i.isHidden()},open:function(o){var n;iconizeTinymceDialog.range=null,o&&(window.wpActiveEditor=o),window.wpActiveEditor&&(iconizeTinymceDialog.textarea=e("#"+window.wpActiveEditor).get(0),"undefined"!=typeof tinymce&&(n=tinymce.get(wpActiveEditor),(i=n&&!n.isHidden()?n:null)&&tinymce.Env.ie&&(i.windowManager.bookmark=i.selection.getBookmark())),!iconizeTinymceDialog.isMCE()&&document.selection&&(iconizeTinymceDialog.textarea.focus(),iconizeTinymceDialog.range=document.selection.createRange()),m.dialog.wpbsmodal("show"))},refresh:function(){if(!y.length)return alert(iconizeDialogParams.l10n.no_icons_defined),!1;c.addClass("loading-overlay"),iconizeTinymceDialog.isMCE()?(tinymce.Env.ie&&i.selection.moveToBookmark(i.windowManager.bookmark),iconizeTinymceDialog.mceRefresh()):(iconizeTinymceDialog.range=null,document.selection&&(iconizeTinymceDialog.textarea.focus(),iconizeTinymceDialog.range=document.selection.createRange()),iconizeTinymceDialog.setDefaultValues())},mceRefresh:function(){var o,c,d,u,A="",P="",_="",x="",E="",O="",B="",I="",M="",V="",N="",Q=!1;if(u=(d=i).selection.getNode(),n=d.dom.hasClass(u,"iconized"),a=d.dom.getParent(u,"span.iconized-stack"),n){if(t.text(iconizeDialogParams.l10n.edit),a){for(m.stack.hide(),l.text(iconizeDialogParams.l10n.stack_size_label),s.text(iconizeDialogParams.l10n.stack_align_label),f=d.dom.getAttrib(a,"class"),v=f.split(/ /),o=0;o<v.length;o++)-1!==e.inArray(v[o],D)&&(x=v[o]),-1!==e.inArray(v[o],T)&&(O=v[o]);d.dom.getStyle(a,"font-size")&&(E=d.dom.getStyle(a,"font-size"))}else m.stack.show(),l.text(iconizeDialogParams.l10n.icon_size_label),s.text(iconizeDialogParams.l10n.icon_align_label);for(g=d.dom.getAttrib(u,"class"),z=g.split(/ /),o=0;o<b.length;o++)-1!==(c=e.inArray(b[o],z))&&z.splice(c,1);for(o=0;o<z.length;o++)-1!==e.inArray(z[o],h)?A=z[o]:-1!==e.inArray(z[o],y)?P=z[o]:a||-1===e.inArray(z[o],D)?a||-1===e.inArray(z[o],T)?-1!==e.inArray(z[o],C)?(I=z[o],B="transform"):-1!==e.inArray(z[o],k)?(M=z[o],B="animate"):-1!==e.inArray(z[o],w)?(V=z[o],B="hover"):S===z[o]?Q=!0:m.custom.tagit("createTag",z[o]):O=z[o]:x=z[o];P&&A?(_=P.replace("glyph-",""),iconizeTinymceDialog.selectIcon(A,_),m.transform.val(I),m.animate.val(M),m.hover.val(V),B?m.effect.val(B):m.effect.val(p[0]),iconizeTinymceDialog.showChildOptions(m.effect),d.dom.getStyle(u,"font-size")&&(E=d.dom.getStyle(u,"font-size")),E?(m.size.val("custom-size"),m.customsize.val(E)):(m.size.val(x),m.customsize.val("")),iconizeTinymceDialog.showChildOptions(m.size),m.align.val(O),d.dom.getStyle(u,"color")?(N=d.dom.getStyle(u,"color"),r.removeClass("hidden")):(N="",r.addClass("hidden")),m.color.val(N),m.color.wpColorPicker("color",N),m.hovercolor.prop("checked",Q),m.submit.text(iconizeDialogParams.l10n.update)):(alert(iconizeDialogParams.l10n.no_icon_found),iconizeTinymceDialog.setDefaultValues())}else iconizeTinymceDialog.setDefaultValues()},close:function(){m.dialog.wpbsmodal("hide")},onClose:function(){iconizeTinymceDialog.isMCE()||iconizeTinymceDialog.range&&(iconizeTinymceDialog.range.moveToBookmark(iconizeTinymceDialog.range.getBookmark()),iconizeTinymceDialog.range.select())},update:function(){iconizeTinymceDialog.isMCE()?iconizeTinymceDialog.mceUpdate():iconizeTinymceDialog.htmlUpdate()},htmlUpdate:function(){var e,i,o,n,a=iconizeTinymceDialog.textarea,c="",t="",l="",s="",r="",d="",g="",z="",f="",v="",u="";a&&((n=m.name.val())?(c=m.set.val(),t=m.size.val(),l=m.customsize.val(),s=m.align.val(),r=m.effect.val(),g=m.color.val(),z=m.hovercolor.prop("checked"),f=(f=(f=m.custom.tagit("assignedTags")).toString()).replace(/,/g," "),"transform"===r?d=m.transform.val():"animate"===r?d=m.animate.val():"hover"===r&&(d=m.hover.val()),(g||"custom-size"===t)&&(u=' style="',u+=g?"color:"+g+";":"",u+=l?"font-size:"+l+";":"",u+='"'),v='<span class="iconized '+c+" glyph-"+n,v+=t&&"custom-size"!==t?" "+t:"",v+=s?" "+s:"",v+=d?" "+d:"",v+=g&&z?" hover-color-change":"",v+=f?" "+f:"",v+='"',v+=u,v+="></span>",document.selection&&iconizeTinymceDialog.range?(a.focus(),iconizeTinymceDialog.range.text=v,iconizeTinymceDialog.range.moveToBookmark(iconizeTinymceDialog.range.getBookmark()),iconizeTinymceDialog.range.select(),iconizeTinymceDialog.range=null):void 0!==a.selectionStart&&(e=a.selectionStart,i=a.selectionEnd,o=e+v.length,a.value=a.value.substring(0,e)+v+a.value.substring(i,a.value.length),a.selectionStart=a.selectionEnd=o),a.focus(),iconizeTinymceDialog.close()):alert(iconizeDialogParams.l10n.no_icon_selected))},mceUpdate:function(){var c,t,l,s=[],r="",d="",u="",p="",h="",y="",C="",k="",w="",A="",P="";if(t=i,tinymce.Env.ie&&t.selection.moveToBookmark(t.updatedSelectionBookmark),l=m.name.val()){for(r=m.set.val(),d=m.size.val(),u=m.customsize.val(),p=m.align.val(),h=m.effect.val(),C=m.color.val(),k=m.hovercolor.prop("checked"),w=(w=(w=m.custom.tagit("assignedTags")).toString()).replace(/,/g," "),"transform"===h?y=m.transform.val():"animate"===h?y=m.animate.val():"hover"===h&&(y=m.hover.val()),o=t.selection.getNode(),n=t.dom.hasClass(o,"iconized"),a=t.dom.getParent(o,"span.iconized-stack"),g=t.dom.getAttrib(o,"class"),z=g.split(/ /),c=0;c<b.length;c++)-1!==e.inArray(b[c],z)&&s.push(b[c]);if(n){if(a){for(f=t.dom.getAttrib(a,"class"),v=f.split(/ /),c=0;c<v.length;c++)(-1!==e.inArray(v[c],D)||-1!==e.inArray(v[c],T))&&t.dom.removeClass(a,v[c]);e(a).removeAttr("data-mce-style")}for(e(o).removeAttr("class"),e(o).removeAttr("data-mce-style"),c=0;c<s.length;c++)t.dom.addClass(o,s[c]);t.dom.addClass(o,r),t.dom.addClass(o,"glyph-"+l),a?("custom-size"===d?t.dom.setStyles(a,{"font-size":u}):(t.dom.setStyles(a,{"font-size":""}),t.dom.addClass(a,d)),p&&t.dom.addClass(a,p)):("custom-size"===d?t.dom.setStyles(o,{"font-size":u}):(t.dom.setStyles(o,{"font-size":""}),t.dom.addClass(o,d)),p&&t.dom.addClass(o,p)),y&&t.dom.addClass(o,y),w&&t.dom.addClass(o,w),C&&k&&t.dom.addClass(o,S),t.dom.setStyles(o,{color:C})}else P="iconized "+r+" glyph-"+l,P+=d&&"custom-size"!==d?" "+d:"",P+=p?" "+p:"",P+=y?" "+y:"",P+=w?" "+w:"",A=t.dom.create("span",{class:P,contenteditable:"false","data-mce-resize":"false"},'<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>'),"custom-size"===d&&t.dom.setStyle(A,"font-size",u),C&&(t.dom.setStyle(A,"color",C),k&&t.dom.addClass(A,S)),t.selection.setNode(A);t.focus(),iconizeTinymceDialog.close()}else alert(iconizeDialogParams.l10n.no_icon_selected)},stack:function(){var n,a,c,t,l,s,r,d,f,v,u="",p="",h="",y="",C="";for(a=i,c=m.set.val(),t=m.name.val(),l=m.size.val(),m.customsize.val(),s=m.align.val(),r=m.effect.val(),d=m.color.val(),f=m.hovercolor.prop("checked"),p=(p=(p=m.custom.tagit("assignedTags")).toString()).replace(/,/g," "),"transform"===r?u=m.transform.val():"animate"===r?u=m.animate.val():"hover"===r&&(u=m.hover.val()),o=a.selection.getNode(),g=a.dom.getAttrib(o,"class"),z=g.split(/ /),n=0;n<z.length;n++)(-1!==e.inArray(z[n],D)||-1!==e.inArray(z[n],T))&&a.dom.removeClass(o,z[n]),a.dom.getStyle(o,"font-size")&&(y=a.dom.getStyle(o,"font-size"));a.dom.addClass(o,"iconized-stack-base"),h='<span contenteditable="false" class="iconized-stack',h+=l&&"custom-size"!==l?" "+l:"",h+=s?" "+s:"",h+='"/>',e(o).wrap(h).parent().css("font-size",y),C="iconized "+c+" glyph-"+t,C+=u?" "+u:"",C+=p?" "+p:"",v=a.dom.create("span",{class:C,contenteditable:"false","data-mce-resize":"false"},'<span class="iconized-placeholder" data-mce-resize="false">|icon|</span>'),d&&(a.dom.setStyle(v,"color",d),f&&a.dom.addClass(v,S)),a.dom.insertAfter(v,o),a.selection.setCursorLocation(v,0),a.focus(),iconizeTinymceDialog.close()},setDefaultValues:function(){iconizeTinymceDialog.unselectIcon(),iconizeTinymceDialog.clearColorPicker(),iconizeTinymceDialog.clearCustomClasses(),m.stack.hide(),m.effect.val(p[0]),m.transform.val(""),m.animate.val(""),m.hover.val(""),iconizeTinymceDialog.showChildOptions(m.effect),m.size.val(""),m.customsize.val(""),iconizeTinymceDialog.showChildOptions(m.size),m.align.val(""),m.color.val(""),m.hovercolor.prop("checked",!1),r.addClass("hidden"),t.text(iconizeDialogParams.l10n.insert),l.text(iconizeDialogParams.l10n.icon_size_label),s.text(iconizeDialogParams.l10n.icon_align_label),m.submit.text(iconizeDialogParams.l10n.insert)},selectIcon:function(e,i){m.set.val(e),c.find(".icons-list").hide(),c.find("#"+e+"-icons-list").show();var o="."+e+".glyph-"+i;c.find(o).parent().addClass("selected-icon"),m.name.val(i)},unselectIcon:function(){c.find(".icons-list-icon.selected-icon").removeClass("selected-icon"),m.name.val(""),m.set.val(h[0]),c.find(".icons-list").hide(),c.find("#"+h[0]+"-icons-list").show()},setColor:function(e){m.color.val(e)},clearColorPicker:function(){m.color.wpColorPicker("color",""),e("#iconize-mce-modal .wp-color-result").removeAttr("style")},clearCustomClasses:function(){m.custom.tagit("removeAll")},scrollToIcon:function(e){var i=e||!1,o="",n=0;(o=m.dialog.find(".selected-icon")).length&&(n=o.position().top-c.position().top+c.scrollTop()-92),!0===i?c.animate({scrollTop:n},"500","swing",(function(){c.removeClass("loading-overlay")})):c.scrollTop(n)},getSelectOptions:function(i){var o=[];return i.find("option").each((function(){var i=e(this).val();o.push(i)})),o},showChildOptions:function(i){var o=i,n=o.val(),a=".mother-opt-"+o.attr("id"),c=".mother-val-"+n;e(a).addClass("hidden"),e(a+c).removeClass("hidden")}},e(document).ready(iconizeTinymceDialog.init)}(jQuery);